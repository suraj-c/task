"use strict";var KTImageInput=function(elementId,options){var the=this,element=KTUtil.getById(elementId);KTUtil.getBody();if(element){var defaultOptions={editMode:!1},Plugin={construct:function(options){return KTUtil.data(element).has("imageinput")?the=KTUtil.data(element).get("imageinput"):(Plugin.init(options),Plugin.build(),KTUtil.data(element).set("imageinput",the)),the},init:function(options){the.element=element,the.events=[],the.input=KTUtil.find(element,'input[type="file"]'),the.wrapper=KTUtil.find(element,".image-input-wrapper"),the.cancel=KTUtil.find(element,'[data-action="cancel"]'),the.remove=KTUtil.find(element,'[data-action="remove"]'),the.src=KTUtil.css(the.wrapper,"backgroundImage"),the.hidden=KTUtil.find(element,'input[type="hidden"]'),the.options=KTUtil.deepExtend({},defaultOptions,options)},build:function(){KTUtil.addEvent(the.input,"change",(function(e){if(e.preventDefault(),the.input&&the.input.files&&the.input.files[0]){var reader=new FileReader;reader.onload=function(e){KTUtil.css(the.wrapper,"background-image","url("+e.target.result+")")},reader.readAsDataURL(the.input.files[0]),KTUtil.addClass(the.element,"image-input-changed"),KTUtil.removeClass(the.element,"image-input-empty"),Plugin.eventTrigger("change")}})),KTUtil.addEvent(the.cancel,"click",(function(e){e.preventDefault(),Plugin.eventTrigger("cancel"),KTUtil.removeClass(the.element,"image-input-changed"),KTUtil.removeClass(the.element,"image-input-empty"),KTUtil.css(the.wrapper,"background-image",the.src),the.input.value="",the.hidden&&(the.hidden.value="0")})),KTUtil.addEvent(the.remove,"click",(function(e){e.preventDefault(),Plugin.eventTrigger("remove"),KTUtil.removeClass(the.element,"image-input-changed"),KTUtil.addClass(the.element,"image-input-empty"),KTUtil.css(the.wrapper,"background-image","none"),the.input.value="",the.hidden&&(the.hidden.value="1")}))},eventTrigger:function(name){for(var i=0;i<the.events.length;i++){var event=the.events[i];if(event.name==name){if(1!=event.one)return event.handler.call(this,the);if(0==event.fired)return the.events[i].fired=!0,event.handler.call(this,the)}}},addEvent:function(name,handler,one){return the.events.push({name:name,handler:handler,one:one,fired:!1}),the}};return the.setDefaults=function(options){defaultOptions=options},the.on=function(name,handler){return Plugin.addEvent(name,handler)},the.one=function(name,handler){return Plugin.addEvent(name,handler,!0)},Plugin.construct.apply(the,[options]),the}};"undefined"!=typeof module&&void 0!==module.exports&&(module.exports=KTImageInput);